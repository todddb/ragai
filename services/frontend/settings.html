<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings</title>
  <link rel="stylesheet" href="css/style.css?v=__ASSET_VERSION__" />
</head>
<body class="page-settings">
  <header>
    <div class="header-left">
      <div class="logo-circle">AI</div>
    </div>
    <div class="header-center">
      <h1>Settings</h1>
      <p>Connectivity, access, and environment controls.</p>
    </div>
    <div class="header-actions">
      <button class="icon-btn nav-icon" onclick="location.href='chat.html'" aria-label="Chat">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6.5 4h11a3.5 3.5 0 0 1 3.5 3.5v5A3.5 3.5 0 0 1 17.5 16H13l-4.4 3.8a1 1 0 0 1-1.6-.8V16H6.5A3.5 3.5 0 0 1 3 12.5v-5A3.5 3.5 0 0 1 6.5 4zm0 2A1.5 1.5 0 0 0 5 7.5v5A1.5 1.5 0 0 0 6.5 14H8a1 1 0 0 1 1 1v1.4l3-2.6a1 1 0 0 1 .6-.2h4.9a1.5 1.5 0 0 0 1.5-1.5v-5A1.5 1.5 0 0 0 17.5 6h-11z" />
        </svg>
      </button>
      <button class="icon-btn nav-icon active" onclick="location.href='settings.html'" aria-label="Settings">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 8.6a3.4 3.4 0 1 1 0 6.8 3.4 3.4 0 0 1 0-6.8zm8.2 2.8a7.7 7.7 0 0 0-.1-1l2-1.5-2-3.4-2.4 1a7.8 7.8 0 0 0-1.7-1l-.3-2.6h-4l-.3 2.6a7.8 7.8 0 0 0-1.7 1l-2.4-1-2 3.4 2 1.5a7.7 7.7 0 0 0 0 2.1l-2 1.5 2 3.4 2.4-1a7.8 7.8 0 0 0 1.7 1l.3 2.6h4l.3-2.6a7.8 7.8 0 0 0 1.7-1l2.4 1 2-3.4-2-1.5c.1-.3.1-.7.1-1.1z" />
        </svg>
      </button>
    </div>
  </header>

  <main class="settings-layout">
    <section class="settings-section">
      <h2>Access</h2>
      <div class="segmented-control mode-toggle" role="tablist" aria-label="Settings mode">
        <span class="segmented-indicator" aria-hidden="true"></span>
        <button class="segmented-button active" id="toggleUser" type="button" role="tab" aria-selected="true">
          User
        </button>
        <button class="segmented-button" id="toggleAdmin" type="button" role="tab" aria-selected="false">
          Admin
        </button>
      </div>
      <div class="admin-lock-row">
        <div class="admin-lock-text" id="adminLockStatus">Admin locked</div>
        <button class="btn btn-small" id="lockAdminButton" type="button">Lock Admin</button>
      </div>

      <div id="adminPanel" class="admin-panel" style="display: none;">
        <section id="unlockSection" class="admin-unlock">
          <div class="field">
            <label class="field-label" for="adminToken">Admin token</label>
            <input type="password" id="adminToken" placeholder="Enter admin token" autocomplete="current-password" />
            <div class="field-help">Enter the token provided by your administrator.</div>
          </div>
          <div class="actions-row">
            <button class="btn btn-primary" id="unlockButton">Unlock</button>
            <div id="unlockError" class="status-text"></div>
          </div>
        </section>

        <section id="adminSection" style="display:none;">
          <div class="admin-header">
            <div class="tabs">
              <button class="tab-button active" data-tab="crawl">Crawl</button>
              <button class="tab-button" data-tab="ingest">Ingest</button>
              <button class="tab-button" data-tab="agents">Agents</button>
              <button class="tab-button" data-tab="logs">Logs</button>
              <button class="tab-button" data-tab="data">Data</button>
            </div>
            <button class="btn" id="lockAdminInline" type="button">Lock Admin</button>
          </div>

          <div id="crawl" class="tab-content">
            <section class="admin-card">
              <div class="card-header">
                <h2>Crawl Configuration (API-managed)</h2>
                <div class="card-actions">
                  <button class="btn btn-primary" id="saveCrawlBtn">Save</button>
                  <span class="status-text" id="saveCrawlStatus"></span>
                </div>
              </div>
              <div class="field-help" style="margin-bottom: 1rem;">
                Crawling is performed by the API container using config/crawler.yml settings. All auth profiles and crawl behavior are configured below.
              </div>

              <div class="field">
                <h3 class="section-heading">Seed URLs</h3>
                <p class="section-help">
                  Starting points for discovery. Use top-level pages you want the crawler to expand from, not login screens or deep content unless required.
                </p>
                <p class="section-help">Example: https://policy.byu.edu/</p>
                <div id="seedList" class="seed-table"></div>
                <div class="list-add">
                  <input id="seedAddInput" type="text" placeholder="https://www.example.com/site/" />
                  <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="checkbox" id="seedAddAllowHttp" />
                    <span style="font-size: 0.85rem;">Allow HTTP</span>
                  </label>
                  <button class="btn" id="seedAddBtn">Add</button>
                </div>
              </div>

              <div class="field" style="margin-top: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <h3 class="section-heading" style="margin: 0; border: none; padding: 0;">Allowed URLs</h3>
                  <a href="#authProfiles" class="link" style="font-size: 0.85rem;" onclick="document.getElementById('authProfiles').scrollIntoView({behavior: 'smooth', block: 'center'}); return false;">Manage Auth Profiles ↓</a>
                </div>
                <p class="section-help">
                  Controls what may be captured and how. Selecting an auth profile implies Playwright is used for that URL rule.
                </p>
                <p class="section-help">Example: allow prefix https://policy.byu.edu/ and assign policy_cas.</p>
                <div class="allowed-table" id="allowTable"></div>
                <div class="list-add">
                  <input id="allowAddInput" type="text" placeholder="https://www.byu.edu/hr/" />
                  <select id="allowAddMatch">
                    <option value="prefix" selected>prefix</option>
                    <option value="exact">exact</option>
                  </select>
                  <div class="type-toggles">
                    <label><input type="checkbox" id="allowAddWeb" checked /> web</label>
                    <label><input type="checkbox" id="allowAddPdf" checked /> pdf</label>
                    <label><input type="checkbox" id="allowAddDocx" /> docx</label>
                    <label><input type="checkbox" id="allowAddXlsx" /> xlsx</label>
                    <label><input type="checkbox" id="allowAddPptx" /> pptx</label>
                    <label><input type="checkbox" id="allowAddAllowHttp" /> Allow HTTP</label>
                  </div>
                  <button class="btn" id="allowAddBtn">Save</button>
                  <span id="allowAddStatus" class="row-status"></span>
                </div>

                <div class="recommendations">
                  <h4 class="rec-header">Recommendations</h4>
                  <div id="allowRecommendations" class="rec-list"></div>
                  <button class="btn btn-small expand-recommendations" id="expandRecommendations" style="display: none; margin-top: 8px;">Show More</button>
                </div>
              </div>

              <div class="field">
                <h3 class="section-heading">Blocked Domains</h3>
                <p class="section-help">
                  Domains never captured or enqueued. Keep CAS blocked to avoid indexing login pages—Playwright can still navigate through CAS during auth.
                </p>
                <div id="blockedList" class="list"></div>
                <div class="list-add">
                  <input id="blockedAddInput" type="text" placeholder="example.com" />
                  <button class="btn" id="blockedAddBtn">Add</button>
                </div>
              </div>
            </section>

            <section class="admin-card">
              <div class="card-header">
                <h3>Authentication (Playwright)</h3>
                <div class="card-actions">
                  <button class="btn btn-primary" id="saveAuthConfigBtn">Save</button>
                  <span class="status-text" id="saveAuthStatus"></span>
                </div>
              </div>

              <p class="section-help">
                Auth profiles store login state for protected sites. Storage states expire over time (BYU CAS sessions often expire within ~24 hours), so recapture when tests fail.
              </p>
              <p class="section-help">
                Use “Test Auth” to validate a profile against its test URL (or the first protected Allowed URL if none is set).
              </p>
              <div id="playwrightWarning" class="warning-banner" style="display: none;">
                Playwright is not available in this environment. Auth checks cannot be run until Playwright is installed.
              </div>

              <div id="migrationBanner" style="display: none; padding: 12px; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; margin-bottom: 1rem;">
                <div style="font-weight: 600; color: #92400e; margin-bottom: 4px;">Migration Required</div>
                <div style="font-size: 0.85rem; color: #78350f;">
                  Legacy Playwright settings detected. Click "Migrate to Auth Profiles" to convert them to the new auth profile format.
                </div>
                <button class="btn btn-small" id="migrateLegacyBtn" style="margin-top: 8px;">Migrate to Auth Profiles</button>
              </div>

              <div class="field" id="authProfiles">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <h4 style="margin: 0; font-size: 1rem; font-weight: 600;">Auth Profiles</h4>
                  <button class="btn btn-small" id="addAuthProfileBtn">+ Add Profile</button>
                </div>
                <div class="field-help" style="margin-bottom: 12px;">
                  Configure authentication profiles for different domains. Each profile contains a Playwright storage state with cookies and auth tokens.
                </div>
                <div id="authProfilesList"></div>
              </div>

              <div id="authProfileEditor" style="display: none; margin-top: 1rem; padding: 1rem; border: 1px solid var(--border-medium); border-radius: 8px; background: #f8fafc;">
                <h4 style="margin-top: 0;">
                  <span id="profileEditorTitle">Add Auth Profile</span>
                  <button class="btn btn-small" id="cancelProfileEdit" style="float: right;">Cancel</button>
                </h4>
                <div class="field">
                  <label class="field-label" for="profileName">Profile name</label>
                  <input type="text" id="profileName" placeholder="e.g., policy_cas" />
                  <div class="field-help">Unique identifier for this auth profile.</div>
                </div>
                <div class="field">
                  <label class="field-label" for="profileStoragePath">Storage state path</label>
                  <input type="text" id="profileStoragePath" placeholder="secrets/playwright/profile-name-storageState.json" />
                  <div class="field-help">Path to Playwright storage state file (relative to repo root, or absolute).</div>
                </div>
                <div class="field">
                  <label class="field-label" for="profileTestUrl">Test URL (optional)</label>
                  <input type="text" id="profileTestUrl" placeholder="https://policy.byu.edu/view/business-gifts-and-entertainment-policy" />
                  <div class="field-help">If provided, this URL is used for auth validation. Otherwise we test the first protected Allowed URL assigned to the profile, or its start URL.</div>
                </div>
                <div class="actions-row">
                  <button class="btn btn-primary" id="saveProfileBtn">Save Profile</button>
                  <span class="status-text" id="profileEditorStatus"></span>
                </div>
              </div>
            </section>
            <div class="actions-row align-right" style="margin-bottom: 1rem;">
              <button class="btn btn-primary" id="triggerCrawl">Trigger Crawl</button>
            </div>
            <div class="log-section">
              <div class="log-header">
                <h3>Live Log</h3>
              </div>
              <div id="crawlPillSummary" style="display: none; margin-bottom: 12px; display: flex; gap: 8px; flex-wrap: wrap;"></div>
              <div class="log-area" id="crawlLog"></div>
              <div id="crawlSummary" class="panel-card" style="display: none; margin-top: 16px;">
                <h4>Crawl Summary</h4>
                <div id="crawlSummaryContent"></div>
              </div>
              <div class="actions-row align-right">
                <span id="crawlLogStatus" class="status-text"></span>
                <button class="btn" id="exportCrawlLog">Export Log</button>
                <button class="btn" id="deleteCrawlLog">Delete Log</button>
              </div>
            </div>
          </div>

          <div id="ingest" class="tab-content" style="display:none;">
            <div class="panel-card">
              <div class="info-grid">
                <div>
                  <div class="field-label">Artifact Directory</div>
                  <div class="info-value">data/artifacts/</div>
                </div>
                <div>
                  <div class="field-label">Last Ingest</div>
                  <div class="info-value" id="lastIngest">-</div>
                </div>
                <div>
                  <div class="field-label">Worker Status</div>
                  <div class="info-value" id="ingestWorkerState">Checking...</div>
                </div>
                <div>
                  <div class="field-label">Queue Depth</div>
                  <div class="info-value" id="ingestQueueDepth">-</div>
                </div>
              </div>
              <div class="actions-row">
                <button class="btn btn-primary" id="startIngestJobBtn">Start Ingest Job (Redis Queue)</button>
                <button class="btn" id="refreshIngestJobBtn">Refresh Status</button>
                <span id="ingestJobStatus" class="status-text"></span>
              </div>
            </div>
            <div class="log-section">
              <div class="log-header">
                <h3>Ingest Log</h3>
              </div>
              <div class="log-area" id="ingestQueueLog"></div>
              <div id="ingestProgressContainer" style="display:none; margin-top:1rem;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                  <div style="flex:1; margin-right:12px;">
                    <div style="font-weight:600; margin-bottom:6px;">Ingest Progress</div>
                    <div style="background:#eef2f6; border-radius:6px; height:14px; overflow:hidden;">
                      <div id="ingestProgressBarFill" style="height:100%; width:0%; background:#007bff; transition: width 400ms ease;"></div>
                    </div>
                  </div>
                  <div style="min-width:260px;">
                    <div style="font-size:13px;">
                      <div>Artifacts: <span id="ingestJobProgress">0 / 0</span></div>
                      <div>ETA: <span id="ingestEta">Calculating…</span></div>
                      <div>Current: <span id="ingestCurrentArtifact">-</span></div>
                      <div style="color:darkred;">Errors: <span id="ingestErrorCount">0</span></div>
                    </div>
                  </div>
                </div>
                <div id="ingestSummaryCard" class="panel-card" style="display:none; margin-top:12px;">
                  <h4>Ingest Summary</h4>
                  <div id="ingestSummaryContent"></div>
                </div>
              </div>
              <div class="actions-row align-right">
                <span id="ingestLogStatus" class="status-text"></span>
                <button class="btn" id="clearIngestLogBtn">Clear</button>
              </div>
            </div>
            <div class="panel-card">
              <details>
                <summary style="cursor:pointer; font-weight:600;">Performance Tuning (GPU utilization)</summary>
                <p class="settings-help" style="margin-top: 8px;">
                  Increase concurrency and batching to better saturate the GPU. Changes apply to new ingest jobs.
                </p>
                <div class="card-grid" style="margin-top: 1rem;">
                  <div class="field">
                    <label class="field-label" for="ingestEmbedConcurrency">Embed concurrency</label>
                    <input type="number" id="ingestEmbedConcurrency" min="1" step="1" />
                  </div>
                  <div class="field">
                    <label class="field-label" for="ingestUpsertBatchSize">Qdrant upsert batch size</label>
                    <input type="number" id="ingestUpsertBatchSize" min="1" step="1" />
                  </div>
                  <div class="field">
                    <label class="field-label" for="ingestChunkBatchSize">Chunk batch size</label>
                    <input type="number" id="ingestChunkBatchSize" min="1" step="1" />
                  </div>
                  <div class="field">
                    <label class="field-label" for="ingestMaxInflightChunks">Max inflight chunks</label>
                    <input type="number" id="ingestMaxInflightChunks" min="1" step="1" />
                  </div>
                </div>
                <div class="actions-row" style="margin-top: 12px;">
                  <button class="btn btn-primary" id="saveIngestPerformance">Save Performance Settings</button>
                  <span id="ingestPerformanceStatus" class="status-text"></span>
                </div>
              </details>
            </div>
            <div class="panel-card">
              <details>
                <summary style="cursor:pointer; font-weight:600;">Advanced / Legacy</summary>
                <p class="settings-help" style="margin-top: 8px;">
                  Legacy ingest runs the non-queue flow and is not recommended. Use only for troubleshooting.
                </p>
                <div class="actions-row">
                  <button class="btn" id="triggerIngestLegacy">Trigger Legacy Ingest</button>
                  <span id="triggerIngestStatus" class="status-text"></span>
                </div>
              </details>
            </div>
          </div>

          <div id="agents" class="tab-content" style="display:none;">
            <div class="card-grid">
              <div class="panel-card">
                <label class="field-label" for="intentPrompt">Intent Agent System Prompt</label>
                <textarea id="intentPrompt" rows="6"></textarea>
              </div>
              <div class="panel-card">
                <label class="field-label" for="researchPrompt">Research Agent System Prompt</label>
                <textarea id="researchPrompt" rows="6"></textarea>
              </div>
              <div class="panel-card">
                <label class="field-label" for="synthesisPrompt">Synthesis Agent System Prompt</label>
                <textarea id="synthesisPrompt" rows="6"></textarea>
              </div>
              <div class="panel-card">
                <label class="field-label" for="validationPrompt">Validation Agent System Prompt</label>
                <textarea id="validationPrompt" rows="6"></textarea>
              </div>
            </div>
            <div class="actions-row align-right">
              <span id="savePromptsStatus" class="status-text"></span>
              <button class="btn btn-primary" id="savePrompts">Save Prompts</button>
            </div>
          </div>

          <div id="logs" class="tab-content" style="display:none;">
            <div class="panel-card">
              <table id="jobTable" class="table"></table>
            </div>
            <div class="log-section">
              <div class="log-header">
                <h3>Job Log</h3>
              </div>
              <div class="log-area" id="jobLog"></div>
              <div class="actions-row align-right">
                <span id="jobLogStatus" class="status-text"></span>
                <button class="btn" id="exportJobLog">Export Log</button>
                <button class="btn" id="deleteJobLog">Delete Log</button>
              </div>
            </div>
          </div>

          <div id="data" class="tab-content" style="display:none;">
            <!-- Pipeline Health -->
            <div class="panel-card" id="pipelineHealthPanel">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h4 style="margin: 0;">Pipeline Health</h4>
                <button class="btn btn-small" id="refreshHealthBtn">Refresh Health</button>
              </div>
              <div id="pipelineHealthStatus" class="status-text" style="margin-bottom: 12px;"></div>
              <div id="pipelineHealthGrid" class="card-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                <!-- Health cards will be rendered here -->
              </div>
            </div>

            <!-- Check Data -->
            <div class="panel-card" id="checkDataPanel">
              <h4>Check Data</h4>
              <p class="settings-help">
                Diagnostic tools to check specific URLs or search across artifacts and vector index.
              </p>

              <!-- Check by URL -->
              <div style="margin-bottom: 24px;">
                <h5 style="margin-bottom: 8px;">Check by URL</h5>
                <div class="actions-row" style="margin-bottom: 12px;">
                  <input type="text" id="checkUrlInput" placeholder="Enter full URL (e.g., https://example.com/page)" style="flex: 1; min-width: 300px;" />
                  <button class="btn btn-primary" id="checkUrlBtn">Check URL</button>
                </div>
                <div id="checkUrlStatus" class="status-text" style="margin-bottom: 8px;"></div>
                <div id="checkUrlResults" style="display: none;">
                  <div class="info-grid" style="grid-template-columns: 1fr;">
                    <div>
                      <div class="field-label">Artifact Status</div>
                      <div id="checkUrlArtifact" class="info-value"></div>
                    </div>
                    <div>
                      <div class="field-label">Validation Status</div>
                      <div id="checkUrlValidation" class="info-value"></div>
                    </div>
                    <div>
                      <div class="field-label">Ingest Status</div>
                      <div id="checkUrlIngest" class="info-value"></div>
                    </div>
                    <div>
                      <div class="field-label">Qdrant Status</div>
                      <div id="checkUrlQdrant" class="info-value"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Search check -->
              <div>
                <h5 style="margin-bottom: 8px;">Search Data</h5>
                <div class="actions-row" style="margin-bottom: 12px;">
                  <input type="text" id="searchDataInput" placeholder="Enter search term (e.g., gift, policy, error)" style="flex: 1; min-width: 300px;" />
                  <button class="btn btn-primary" id="searchDataBtn">Search</button>
                </div>
                <div id="searchDataStatus" class="status-text" style="margin-bottom: 8px;"></div>
                <div id="searchDataResults" style="display: none;">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                      <h6 style="margin-bottom: 8px;">Artifact Matches</h6>
                      <div id="searchArtifactResults" class="validation-list" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>
                    <div>
                      <h6 style="margin-bottom: 8px;">Qdrant Semantic Matches</h6>
                      <div id="searchQdrantResults" class="validation-list" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="panel-card" id="dataValidationPanel">
              <h4>Validate Crawl Artifacts</h4>
              <p class="settings-help">
                Validate stored crawl artifacts, flag suspicious entries, and optionally quarantine them. Quarantined artifacts move to <code>data/quarantine/</code> and can be restored manually.
              </p>
              <div class="actions-row">
                <button class="btn btn-primary" id="validateArtifactsBtn">Validate Crawl</button>
                <button class="btn" id="refreshValidationBtn">Refresh Summary</button>
                <button class="btn btn-danger" id="quarantineSelectedBtn">Quarantine Selected</button>
                <span id="dataValidationStatus" class="status-text"></span>
              </div>

              <div id="validationSummary" class="info-grid" style="margin-top:12px;"></div>
              <div class="table-actions" style="margin-top:12px; display:flex; justify-content:space-between; align-items:center;">
                <label style="display:flex; align-items:center; gap:6px;">
                  <input type="checkbox" id="selectAllValidation" />
                  Select all
                </label>
                <span id="selectedValidationCount" class="status-text"></span>
              </div>
              <div id="validationList" class="validation-list" style="margin-top:12px;"></div>
            </div>

            <div class="panel-card" id="ingestValidationPanel">
              <h4>Validate Ingest Output</h4>
              <p class="settings-help">
                Checks ingest metadata, Qdrant vectors, and job state for mismatches.
              </p>
              <div class="actions-row">
                <button class="btn btn-primary" id="validateIngestBtn">Validate Ingest</button>
                <button class="btn" id="refreshIngestValidationBtn">Refresh Summary</button>
                <span id="ingestValidationStatus" class="status-text"></span>
              </div>
              <div id="ingestValidationSummary" class="info-grid" style="margin-top:12px;"></div>
              <div id="ingestValidationFindings" class="validation-list" style="margin-top:12px;"></div>
            </div>

            <div class="panel-card">
              <h2>Data Management</h2>
              <p class="settings-help">
                These actions are <strong>destructive</strong> and <strong>cannot be undone</strong>.
                Each operation requires explicit confirmation by typing DELETE.
              </p>

              <div class="card-grid" style="margin-top: 1rem;">
                <div class="panel-card">
                  <h3 style="margin-top: 0; font-size: 1rem;">Reset Crawl State</h3>
                  <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                    Deletes all crawled artifacts, candidates, job logs, and summaries.
                  </p>
                  <div class="info-grid" style="font-size: 0.75rem; margin-bottom: 1rem;">
                    <div>
                      <div class="field-label">Will delete:</div>
                      <div class="info-value">
                        • data/artifacts/*<br>
                        • data/candidates/*<br>
                        • data/logs/jobs/*<br>
                        • data/logs/summaries/*
                      </div>
                    </div>
                  </div>
                  <div class="actions-row">
                    <button class="btn" id="resetCrawl">Reset Crawl State</button>
                    <span id="resetCrawlStatus" class="status-text"></span>
                  </div>
                </div>

                <div class="panel-card">
                  <h3 style="margin-top: 0; font-size: 1rem;">Reset Ingest State</h3>
                  <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                    Deletes the ingest metadata database (documents and chunks tables).
                  </p>
                  <div class="info-grid" style="font-size: 0.75rem; margin-bottom: 1rem;">
                    <div>
                      <div class="field-label">Will delete:</div>
                      <div class="info-value">
                        • data/ingest/metadata.db
                      </div>
                    </div>
                    <div>
                      <div class="field-label">Note:</div>
                      <div class="info-value">
                        Does NOT delete vectors from Qdrant
                      </div>
                    </div>
                  </div>
                  <div class="actions-row">
                    <button class="btn" id="resetIngest">Reset Ingest State</button>
                    <span id="resetIngestStatus" class="status-text"></span>
                  </div>
                </div>

                <div class="panel-card">
                  <h3 style="margin-top: 0; font-size: 1rem;">Clear Vector Index</h3>
                  <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                    Deletes the Qdrant collection and ingest metadata database, then recreates an empty collection.
                  </p>
                  <div class="info-grid" style="font-size: 0.75rem; margin-bottom: 1rem;">
                    <div>
                      <div class="field-label">Will delete:</div>
                      <div class="info-value">
                        • All vectors in Qdrant collection<br>
                        • data/ingest/metadata.db
                      </div>
                    </div>
                    <div>
                      <div class="field-label">Collection:</div>
                      <div class="info-value" id="qdrantCollectionName">ragai_chunks</div>
                    </div>
                  </div>
                  <div class="actions-row">
                    <button class="btn" id="clearVectorsNew">Clear Vector Index</button>
                    <span id="clearVectorsStatus" class="status-text"></span>
                  </div>
                </div>
              </div>
              <div class="panel-card" style="margin-top: 1rem;">
                <h3 style="margin-top: 0; font-size: 1rem;">Danger Zone: Nuke All Data</h3>
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                  Deletes artifacts, logs, quarantine, Qdrant vectors, and ingest metadata. Requires typing DELETE.
                </p>
                <div class="actions-row">
                  <button class="btn btn-danger" id="resetAllData">Nuke Data / Start Over</button>
                  <span id="resetAllStatus" class="status-text"></span>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <section class="settings-section">
      <div class="section-header">
        <h2>Connection</h2>
        <button class="btn btn-primary" id="testConnection">Test Connection</button>
      </div>
      <div class="conn-row">
        <div class="settings-card conn-tile">
          <div class="settings-label">API Base URL</div>
          <div class="settings-value" id="apiBaseDisplay">-</div>
        </div>
        <div class="settings-card conn-tile">
          <div class="settings-label">API Status</div>
          <div class="settings-value">
            <span id="apiStatus" class="status-pill">Unknown</span>
          </div>
        </div>
        <div class="settings-card conn-tile">
          <div class="settings-label">Ollama Status</div>
          <div class="settings-value">
            <span id="ollamaStatus" class="status-pill">Unknown</span>
          </div>
        </div>
        <div class="settings-card conn-tile">
          <div class="settings-label">Qdrant Status</div>
          <div class="settings-value">
            <span id="qdrantStatus" class="status-pill">Unknown</span>
          </div>
        </div>
        <div class="settings-card conn-tile">
          <div class="settings-label">Ollama Model</div>
          <div class="settings-value" id="ollamaModel">-</div>
        </div>
      </div>
      <div id="connectionMessage" class="status-text"></div>
    </section>
  </main>

  <div class="footer">
    <span>© 2026 AI RAG Assistant</span>
    <span class="build-version">v__ASSET_VERSION__</span>
  </div>

  <script>
    window.API_URL = window.API_URL || localStorage.getItem('API_URL');
  </script>
  <script src="js/config.js?v=__ASSET_VERSION__"></script>
  <script src="js/admin.js?v=__ASSET_VERSION__"></script>
  <script src="js/settings.js?v=__ASSET_VERSION__"></script>
</body>
</html>
